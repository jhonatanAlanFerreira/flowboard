<div
  class="flex max-h-full min-w-70 cursor-move flex-col rounded-2xl border border-zinc-800 bg-[#09090b] p-3 text-white"
  [class.bg-red-900!]="isDeletingModalOpen || workspaceDeleting()"
>
  <div class="mb-2 flex justify-between">
    <div class="flex w-full flex-col">
      <p class="p-3">{{ tasklist()?.name }}</p>
      <p-divider class="w-5/6! self-center! opacity-8!"></p-divider>
    </div>
    @if (!workspaceDeleting()) {
    <app-edit-button-component
      (onDelete)="isDeletingModalOpen = true"
    ></app-edit-button-component>
    }
  </div>
  <div
    cdkScrollable
    cdkDropList
    [cdkDropListData]="tasklist()!.tasks"
    (cdkDropListDropped)="onDropTask($event)"
    class="mb-2 min-h-20 overflow-auto"
  >
    @for (task of tasklist()!.tasks; track task.id) {
    <div cdkDrag [cdkDragData]="task" class="my-4">
      <app-task-component
        [deletingList]="isDeletingModalOpen || workspaceDeleting()"
        (onDelete)="onTaskDelete.emit()"
        [task]="task"
      />
    </div>
    }
  </div>

  <p-button
    (onClick)="isTaskModalOpen = true"
    label="Create new Task"
    fluid
    severity="secondary"
    text
    size="small"
    icon="pi pi-plus"
    class="whitespace-nowrap"
  />
</div>

<div class="card flex justify-center">
  <p-dialog
    header="Create new Task"
    (onHide)="newTaskFormGroup.get('description')?.reset()"
    [modal]="true"
    [(visible)]="isTaskModalOpen"
    [style]="{ width: '25rem' }"
  >
    <div [formGroup]="newTaskFormGroup" class="mb-4 flex">
      <textarea
        formControlName="description"
        placeholder="Task description"
        pInputText
        class="flex-auto p-2"
        autocomplete="off"
      ></textarea>
    </div>
    <div class="flex justify-end gap-2">
      <p-button
        [style]="{ backgroundColor: '#18181c', color: '#ffffff', border: 'none' }"
        class=""
        label="Cancel"
        (click)="isTaskModalOpen = false"
      />
      <p-button
        [disabled]="!newTaskFormGroup.get('description')?.value"
        [style]="{ backgroundColor: '#ffffff', color: '#18181c', border: 'none' }"
        label="Save"
        (click)="createNewTask()"
      />
    </div>
  </p-dialog>
</div>

<div class="card flex justify-center">
  <p-dialog
    header="Are you sure you want to delete this list?"
    [modal]="true"
    [(visible)]="isDeletingModalOpen"
    [closable]="false"
    [style]="{ width: '25rem' }"
  >
    <div class="flex justify-end gap-2">
      <p-button
        [style]="{ backgroundColor: '#18181c', color: '#ffffff', border: 'none' }"
        class=""
        label="Cancel"
        (click)="isDeletingModalOpen = false"
      />
      <p-button
        [style]="{ backgroundColor: '#ffffff', color: '#18181c', border: 'none' }"
        label="Yes"
        (click)="delete()"
      />
    </div>
  </p-dialog>
</div>
