<div class="h-screen w-screen flex flex-col">
  <div class="h-15 bg-gray-500 w-full p-3">
    <div class="flex gap-2 h-full items-center">
      @if(!isWorkspaceDeletingOpen){
      <app-dropdown-component
        [formControl]="workspaceControl"
        (change)="listTasklistsFromWorkspace()"
        [options]="workspaces()"
        placeholder="Select Workspace"
        optionLabel="name"
        [addOption]="true"
        (onAdd)="isWorkspaceModalOpen = true"
      ></app-dropdown-component>
      } @else {
      <span class="bg-red-900 rounded-lg p-2 min-w-50 text-white whitespace-nowrap">{{
        workspaceControl.value?.name
      }}</span>
      } @if(workspaceControl.value){
      <app-edit-button-component
        (onDelete)="isWorkspaceDeletingOpen = true"
      ></app-edit-button-component>
      }
    </div>
  </div>
  <div
    cdkDropList
    cdkDropListOrientation="horizontal"
    (cdkDropListDropped)="onDropTasklist($event)"
    class="flex flex-row gap-5 mt-4 mx-2 overflow-y-hidden flex-1 pb-2"
  >
    <ng-container cdkDropListGroup>
      @for (tasklist of tasklists(); track tasklist.id) {
      <app-tasklist-component
        cdkDrag
        cdkDragLockAxis="x"
        [cdkDragData]="tasklist.id"
        (onTaskCreated)="listTasklistsFromWorkspace()"
        (onTaskDelete)="listTasklistsFromWorkspace()"
        (onTasklistDelete)="listTasklistsFromWorkspace()"
        [tasklist]="tasklist"
        [workspaceDeleting]="isWorkspaceDeletingOpen"
      ></app-tasklist-component>
      }</ng-container
    >
    @if(workspaceControl.value && !isWorkspaceDeletingOpen){
    <div class="h-fit min-w-70 bg-[#09090b] border border-zinc-800 rounded-lg">
      <p-button
        (onClick)="isListModalOpen = true"
        label="Create new List"
        fluid
        severity="secondary"
        text
        size="small"
        icon="pi pi-plus"
        class="whitespace-nowrap"
      />
    </div>
    }
  </div>
</div>

<div class="card flex justify-center">
  <p-dialog
    header="Create new Workspace"
    (onHide)="newWorkspaceControl.reset()"
    [modal]="true"
    [(visible)]="isWorkspaceModalOpen"
    [style]="{ width: '25rem' }"
  >
    <div class="flex mb-4">
      <input
        [formControl]="newWorkspaceControl"
        placeholder="Workspace name"
        pInputText
        class="flex-auto p-2"
        autocomplete="off"
      />
    </div>
    <div class="flex justify-end gap-2">
      <p-button
        [style]="{ backgroundColor: '#18181c', color: '#ffffff', border: 'none' }"
        class=""
        label="Cancel"
        (click)="isWorkspaceModalOpen = false"
      />
      <p-button
        [disabled]="!newWorkspaceControl.value"
        [style]="{ backgroundColor: '#ffffff', color: '#18181c', border: 'none' }"
        label="Save"
        (click)="createWorkspace()"
      />
    </div>
  </p-dialog>
</div>

<div class="card flex justify-center">
  <p-dialog
    header="Create new List"
    (onHide)="newListFormGroup.get('name')?.reset()"
    [modal]="true"
    [(visible)]="isListModalOpen"
    [style]="{ width: '25rem' }"
  >
    <div [formGroup]="newListFormGroup" class="flex mb-4">
      <input
        formControlName="name"
        placeholder="List name"
        pInputText
        class="flex-auto p-2"
        autocomplete="off"
      />
    </div>
    <div class="flex justify-end gap-2">
      <p-button
        [style]="{ backgroundColor: '#18181c', color: '#ffffff', border: 'none' }"
        class=""
        label="Cancel"
        (click)="isListModalOpen = false"
      />
      <p-button
        [disabled]="!newListFormGroup.get('name')?.value"
        [style]="{ backgroundColor: '#ffffff', color: '#18181c', border: 'none' }"
        label="Save"
        (click)="createNewList()"
      />
    </div>
  </p-dialog>
</div>

<div class="card flex justify-center">
  <p-dialog
    header="Are you sure you want to delete this workspace?"
    [modal]="true"
    [(visible)]="isWorkspaceDeletingOpen"
    [closable]="false"
    [style]="{ width: '25rem' }"
  >
    <div class="flex justify-end gap-2">
      <p-button
        [style]="{ backgroundColor: '#18181c', color: '#ffffff', border: 'none' }"
        class=""
        label="Cancel"
        (click)="isWorkspaceDeletingOpen = false"
      />
      <p-button
        [style]="{ backgroundColor: '#ffffff', color: '#18181c', border: 'none' }"
        label="Yes"
        (click)="deleteWorkspace()"
      />
    </div>
  </p-dialog>
</div>
