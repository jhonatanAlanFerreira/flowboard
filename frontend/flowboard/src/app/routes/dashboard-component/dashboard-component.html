<div class="flex h-screen w-screen flex-col">
  <div class="h-15 w-full bg-gray-500 p-3">
    <div class="flex h-full items-center gap-2">
      @if (!isWorkspaceDeletingModalOpen) {
      <app-dropdown-component
        [formControl]="workspaceControl"
        (change)="listTasklistsFromWorkspace()"
        [options]="workspaces()"
        placeholder="Select Workspace"
        optionLabel="name"
        [addOption]="true"
        (onAdd)="onAddWorkspace()"
      ></app-dropdown-component>
      } @else {
      <span
        class="min-w-50 rounded-lg bg-red-900 p-2 whitespace-nowrap text-white"
        >{{ workspaceControl.value?.name }}</span
      >
      } @if (workspaceControl.value) {
      <app-edit-button-component
        (onDelete)="onWorkspaceDelete()"
        (onEdit)="onWorkspaceEdit()"
      ></app-edit-button-component>
      }
    </div>
  </div>
  <div
    cdkDropList
    cdkDropListOrientation="horizontal"
    (cdkDropListDropped)="onDropTasklist($event)"
    class="mx-2 mt-4 flex flex-1 flex-row gap-5 overflow-y-hidden pb-2"
  >
    <ng-container cdkDropListGroup>
      @for (tasklist of tasklists(); track tasklist.id) {
      <app-tasklist-component
        cdkDrag
        cdkDragLockAxis="x"
        [cdkDragData]="tasklist"
        (onTaskCreate)="onTaskCreate($event)"
        (onTaskDelete)="onTaskDelete($event)"
        (onTasklistEdit)="onTasklistEdit($event)"
        (onTasklistDelete)="onTasklistDelete($event)"
        (onTaskEdit)="onTaskEdit($event)"
        [tasklist]="tasklist"
        [isDeleting]="isListDeleting(tasklist)"
        [taskIdDeleting]="isTaskDeletingModalOpen.data?.taskId"
        [taskIdEditing]="isTaskModalOpen.data?.task?.id"
      ></app-tasklist-component>
      }
    </ng-container>
    @if (workspaceControl.value && !isWorkspaceDeletingModalOpen) {
    <div class="h-fit min-w-70 rounded-lg border border-zinc-800 bg-[#09090b]">
      <p-button
        (onClick)="onCreateNewList()"
        label="Create new List"
        fluid
        severity="secondary"
        text
        size="small"
        icon="pi pi-plus"
        class="whitespace-nowrap"
      />
    </div>
    }
  </div>
</div>

<app-dialog-component
  header="Are you sure you want to delete this Workspace?"
  [visible]="isWorkspaceDeletingModalOpen"
  (onCancel)="isWorkspaceDeletingModalOpen = false"
  (onConfirm)="deleteWorkspace()"
></app-dialog-component>

<app-dialog-component
  header="Are you sure you want to delete this List?"
  [visible]="isListDeletingModalOpen.opened"
  (onCancel)="isListDeletingModalOpen.opened = false"
  (onConfirm)="deleteTasklist()"
></app-dialog-component>

<app-dialog-component
  header="Are you sure you want to delete this Task?"
  [visible]="isTaskDeletingModalOpen.opened"
  (onCancel)="onCancelTaskDeleting() "
  (onConfirm)="deleteTask()"
></app-dialog-component>

<app-workspace-modal-component
  [visible]="isWorkspaceModalOpen.opened"
  (onCancel)="onWorkspaceModalCancel()"
  (onSave)="onWorkspaceModalSave($event)"
  [workspace]="isWorkspaceModalOpen.data"
></app-workspace-modal-component>

<app-tasklist-modal-component
  [visible]="isListModalOpen.opened"
  (onCancel)="onListModalCancel()"
  (onSave)="onListModalSave()"
  [workspaceId]="workspaceControl.value?.id!"
  [tasklist]="isListModalOpen.data"
></app-tasklist-modal-component>

<app-task-modal-component
  [visible]="isTaskModalOpen.opened"
  [tasklistId]="isTaskModalOpen.data?.tasklistId!"
  [task]="isTaskModalOpen.data?.task!"
  (onCancel)="onTaskModalCancel()"
  (onSave)="onTaskModalSave()"
></app-task-modal-component>
